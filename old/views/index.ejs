<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="">
    <meta name="author" content="">

    <title>jMonitor Dashboard</title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
    <style>
        body {
            padding-top: 50px;
        }

        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }

        .compLabel {
            margin-top: 40px;
        }

        #osvers {
            height: 5px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
                <a class="navbar-brand" href="#">jMonitor</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
    </nav>

    <div class="container">

        <div class="starter-template">
            <h1>jMonitor Dashboard</h1>
            <p class="lead">Easy to use macOS monitoring system.<br></p>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="text-center">
                    <h3>Computers by OS Version</h3>
                </div>
                <canvas id="osvers"></canvas>
            </div>
            <div class="col-md-6">
                <div class="text-center">
                    <h3>Last Check-in of Computers</h3>
                </div>
                <canvas id="lastcheckin"></canvas>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="text-center" id="compLabel">
                <h3>List of Computers</h3>
            </div>
            <div class="table-responsive">
                <table class="table table-striped" id="computers">
                    <tr>
                        <th>Hostname</th>
                        <th>Mac Address</th>
                        <th>IP Address</th>
                        <th>OS Name</th>
                        <th>OS Version</th>
                        <th>OS Build</th>
                        <th>Processor</th>
                        <th>RAM</th>
                        <th>Last Check-in</th>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="/js/test.js"></script>
    <script>
        $.ajax({
            url: "http://localhost/data.php",
            method: "GET",
            success: function(data) {
                var today = Date.now();
                var jslast_checkin = [];
                var macAddr = [];
                var hostname = [];
                var last_checkin = [];
                var osvers = [];
                var sierra2 = 0;
                var sierra1 = 0;
                var sierra0 = 0;
                var elcap6 = 0;
                var elcap5 = 0;
                var elcap4 = 0;
                var elcap3 = 0;
                var elcap2 = 0;
                var elcap1 = 0;
                var elcap0 = 0;



                for (var i in data) {
                    macAddr.push(data[i].macAddr);
                    hostname.push(data[i].hostname);
                    last_checkin.push(data[i].last_checkin);
                    if (data[i].osvers == "10.12.2") {
                        sierra2 += 1;
                    } else if (data[i].osvers == "10.12.1") {
                        sierra1 += 1;
                    } else if (data[i].osvers == "10.12.0") {
                        sierra0 += 1;
                    } else if (data[i].osvers == "10.11.6") {
                        elcap6 += 1;
                    } else if (data[i].osvers == "10.11.5") {
                        elcap5 += 1;
                    } else if (data[i].osvers == "10.11.4") {
                        elcap4 += 1;
                    } else if (data[i].osvers == "10.11.3") {
                        elcap3 += 1;
                    } else if (data[i].osvers == "10.11.2") {
                        elcap2 += 1;
                    } else if (data[i].osvers == "10.11.1") {
                        elcap1 += 1;
                    } else if (data[i].osvers == "10.11.0") {
                        elcap0 += 1;
                    }

                    osvers.push(data[i].osvers);

                    var sqlDateArr1 = data[i].last_checkin.split("-");
                    var sYear = sqlDateArr1[0];
                    var sMonth = (Number(sqlDateArr1[1]) - 1).toString();
                    var sqlDateArr2 = sqlDateArr1[2].split(" ");
                    var sDay = sqlDateArr2[0];
                    var sqlDateArr3 = sqlDateArr2[1].split(":");
                    var sHour = sqlDateArr3[0];
                    var sMinute = sqlDateArr3[1];
                    var sqlDateArr4 = sqlDateArr3[2].split(".");
                    var sSecond = sqlDateArr4[0];
                    jslast_checkin.push(new Date(sYear, sMonth, sDay, sHour, sMinute, sSecond));

                    var MATH = 1000 * 60 * 60 * 24;

                    var diff = today - jslast_checkin[i];
                    var days = diff / MATH;
                    if (days >= 7) {
                        $('#computers > tbody:last-child').append('<tr class="danger"><td>' +
                            '<a onclick="test(\'' + data[i].macAddr + '\')" class="btn btn-default btn-sm">' +
                            data[i].hostname + '</a></td><td>' + data[i].macAddr +
                            '</td><td>' + data[i].ip + '</td><td>' + data[i].osname +
                            '</td><td>' + data[i].osvers + '</td><td>' + data[i].osbuild +
                            '</td><td>' + data[i].processor + '</td><td>' + data[i].memory +
                            '</td><td>' + data[i].last_checkin + '</td></tr>');
                    } else {
                        $('#computers > tbody:last-child').append('<tr><td>' +
                            '<a onclick="test(\'' + data[i].macAddr + '\')" class="btn btn-default btn-sm">' +
                            data[i].hostname + '</a></td><td>' + data[i].macAddr +
                            '</td><td>' + data[i].ip + '</td><td>' + data[i].osname +
                            '</td><td>' + data[i].osvers + '</td><td>' + data[i].osbuild +
                            '</td><td>' + data[i].processor + '</td><td>' + data[i].memory +
                            '</td><td>' + data[i].last_checkin + '</td></tr>');
                    }
                }

                var ctx = $('#osvers')[0].getContext('2d');
                var myChart1 = new Chart(ctx, {
                    type: 'bar',
                    responsive: false,
                    data: {
                        labels: ["10.12.2", "10.12.1", "10.12.0", "10.11.6", "10.11.5", "10.11.4", "10.11.3", "10.11.2", "10.11.1", "10.11.0"],
                        datasets: [{
                            label: 'Number of Computers',
                            data: [sierra2, sierra1, sierra0, elcap6, elcap5, elcap4, elcap3, elcap2, elcap1, elcap0]
                        }]
                    }
                });
                var greatSev = 0;
                var greatFour = 0;
                var greatTwo = 0;
                var greatOne = 0;
                var lessOne = 0;
                var MATH = 1000 * 60 * 60 * 24;

                for (var i in jslast_checkin) {
                    var diff = today - jslast_checkin[i];
                    var days = diff / MATH;
                    if (days >= 7) {
                        greatSev += 1;
                    } else if (days >= 4 && days < 7) {
                        greatFour += 1;
                    } else if (days >= 2 && days < 4) {
                        greatTwo += 1;
                    } else if (days >= 1 && days < 2) {
                        greatOne += 1;
                    } else if (days < 1) {
                        lessOne += 1;
                    }
                }



                var ctx2 = document.getElementById("lastcheckin").getContext("2d");
                var doughData = [
                  greatSev,
                  greatFour,
                  greatTwo,
                  greatOne,
                  lessOne
                ]
                new Chart(ctx2).Doughnut(doughData);
                /*ctx2.canvas.height = 200;
                var myChart2 = new Chart(ctx2, {
                    type: 'doughnut',
                    responsive: false,
                    data: {
                        labels: [">=7 Days", ">=4 Days", ">=2 Days", ">=1 Day", "<1 Day"],
                        datasets: [{
                            label: 'Last Check-in',
                            data: [greatSev, greatFour, greatTwo, greatOne, lessOne],
                            backgroundColor: [
                                "#ff0000",
                                "#003366",
                                "#ffff00",
                                "#0000ff",
                                "#00ff00"
                            ],
                            hoverBackgroundColor: [
                                "#ff0000",
                                "#003366",
                                "#ffff00",
                                "#0000ff",
                                "#00ff00"
                            ]
                        }]
                    },
                    options: {
                        elements: {
                            arc: {
                                borderColor: "#000000"
                            }
                        }
                    }
                });*/

            },
            async: false,
            error: function(data) {
                console.log(data);
            }
        });

    </script>
</body>

</html>


<!DOCTYPE html>
<html>

<head>
    <title>ChartJS - BarGraph</title>

    <style type="text/css">
        #chart-container {
            width: 640px;
            height: auto;
        }
    </style>
</head>

<body>

</body>

</html>
